<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>愚炖的故事</title>
        <link>http://jetgeng.github.com/blog/html/</link>
        <description>一个程序员的成长录</description>
        <language>en-us</language>
        <pubDate>Tue, 21 Aug 2012 16:00:00 GMT</pubDate>
        <item>
            <link>http://jetgeng.github.com/blog/html/2012/08/22/xtext_start.html</link>
            <guid>http://jetgeng.github.com/blog/html/2012/08/22/xtext_start.html</guid>
            <title>学习xtext语法</title>
            <description><![CDATA[<?xml version="1.0" ?><body><div class="section" id="xtext">
<h1>学习xtext语法</h1>
<p>有人说通过例子学习是最快的学习方式，所以我找到了 <a class="reference external" href="http://git.eclipse.org/c/tmf/org.eclipse.xtext.git/plain/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/Xbase.xtext">Xbase</a>  来学习Xtext。简单小结如下，防备以后忘。</p>
<div class="section" id="simple-action">
<h2>Simple Action(简单动作)</h2>
</div>
</div>
</body>]]></description>
            <category><![CDATA[ Java ]]></category>
            <pubDate>Tue, 21 Aug 2012 16:00:00 GMT</pubDate>
        </item>
        <item>
            <link>http://jetgeng.github.com/blog/html/2012/08/21/pyaudio.html</link>
            <guid>http://jetgeng.github.com/blog/html/2012/08/21/pyaudio.html</guid>
            <title>Kid Capture开发手记</title>
            <description><![CDATA[<?xml version="1.0" ?><body><div class="section" id="kid-capture">
<h1>Kid Capture开发手记</h1>
<div class="section" id="id1">
<h2>缘起</h2>
<p>我四岁的儿子和他10谁的表哥迷上了我的电脑，只要我不用就和他哥跑到电脑前。随后就会传来一阵阵的狂笑。我过去一看发现他们抱着Photo Booth狂拍照片，狂拍视屏。被那些加上各种各样效果的视屏逗的开心死了。
这个时候我就在想我自己能否做一个这种小东西呢？让儿子在他妈妈的 <strong>瘟都死</strong> （Windows）上也能用呢？
整理整理思路就动手做吧！</p>
</div>
<div class="section" id="id2">
<h2>需求</h2>
<dl class="docutils">
<dt>虽然是个小东西，但是也要简单列举一下需求。以确定开发的边界。</dt>
<dd><ol class="first last arabic">
<li><p class="first">通过摄像头获取图像信息。显示到主界面上。</p>
</li>
<li><p class="first">提供三个功能按钮</p>
<dl class="docutils">
<dt><strong>开始录制视屏</strong></dt>
<dd><p class="first last">点击后就开始将摄像头获取的图片信息以视频流的形式保存成一个文件。同时还需要记录下麦克风的声音。保存成文件</p>
</dd>
<dt><strong>停止录制</strong></dt>
<dd><p class="first last">停止录制的过程，将声音文件和视频文件合并成一个小电影</p>
</dd>
<dt><strong>拍照</strong></dt>
<dd><p class="first last">将摄像头的当前帧保存成文件</p>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
<p>第一个版本先做这么多吧！关于效果部分后续在跟进</p>
</div>
<div class="section" id="id3">
<h2>技术方案</h2>
<p>由于我预定的目标平台是 <strong>瘟都死</strong>  又不想使用笨重的Visual Studio。
所以决定采用如下的工具</p>
<blockquote>
<div><ol class="arabic simple">
<li>开发语言– <a class="reference external" href="http://python.org/">Python</a></li>
<li>图形界面框架 – <a class="reference external" href="http://wxpython.org/">wxPython</a></li>
<li>图像采集和分析框架 – <a class="reference external" href="http://opencv.org/">OpenCV</a></li>
<li>声音采集工具  – <a class="reference external" href="http://people.csail.mit.edu/hubert/pyaudio/">PyAudio</a></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id4">
<h2>图像采集</h2>
<p>图像采集说白了就是从摄像头读取图像信息。在微软家有Direct.Show 可以用。从CodeProject网站上可以找到大量的示例，不是C#就是VB。 当然通过Python也可以调用，只是要求系统上一定要有Direct。所以放弃。最后在Youtube上看到一老外用不到10行代码完成了视屏采集。为之一动，对自己说就用他吧！他就是OpenCV。</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">capture</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CaptureFromCAM</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">cv</span><span class="o">.</span><span class="n">NamedWindow</span><span class="p">(</span><span class="s">&quot;camera&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">QueryFrame</span><span class="p">(</span><span class="n">capture</span><span class="p">)</span>
    <span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;camera&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&amp;</span> <span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="pyaudio">
<h1>初次接触PyAudio</h1>
<p>前两天无意间PyAudio，当时没觉得怎么地。今天拿过来练了练。发现这个小东西还真的不错。只需要简单的几行代码就可以完成录音和播放wav的功能。而且他还是跨平台的，在WinXp和Linux下运行良好（遗憾的是在Mac OS Lion下编译没通过）。</p>
<p>下面这个代码来源于实现了录音功能。 <a class="reference external" href="http://hyry.dip.jp:8000/pydoc/wave_pyaudio.html#pyaudio">http://hyry.dip.jp:8000/pydoc/wave_pyaudio.html#pyaudio</a> 。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">pyaudio</span> <span class="kn">import</span> <span class="n">PyAudio</span><span class="p">,</span> <span class="n">paInt16</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">wave</span>


<span class="c"># 将data中的数据保存到名为filename的WAV文件中</span>
<span class="k">def</span> <span class="nf">save_wave_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">wf</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">setnchannels</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">setsampwidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">setframerate</span><span class="p">(</span><span class="n">SAMPLING_RATE</span><span class="p">)</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">writeframes</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>



<span class="n">NUM_SAMPLES</span> <span class="o">=</span> <span class="mi">2000</span>      <span class="c"># pyAudio内部缓存的块的大小</span>
<span class="n">SAMPLING_RATE</span> <span class="o">=</span> <span class="mi">8000</span>    <span class="c"># 取样频率</span>
<span class="n">LEVEL</span> <span class="o">=</span> <span class="mi">1500</span>            <span class="c"># 声音保存的阈值</span>
<span class="n">COUNT_NUM</span> <span class="o">=</span> <span class="mi">20</span>          <span class="c"># NUM_SAMPLES个取样之内出现COUNT_NUM个大于LEVEL的取样则记录声音</span>
<span class="n">SAVE_LENGTH</span> <span class="o">=</span> <span class="mi">8</span>         <span class="c"># 声音记录的最小长度：SAVE_LENGTH * NUM_SAMPLES 个取样</span>

<span class="c"># 开启声音输入</span>
<span class="n">pa</span> <span class="o">=</span> <span class="n">PyAudio</span><span class="p">()</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="n">paInt16</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">SAMPLING_RATE</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">frames_per_buffer</span><span class="o">=</span><span class="n">NUM_SAMPLES</span><span class="p">)</span>

<span class="n">save_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">save_buffer</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c"># 读入NUM_SAMPLES个取样</span>
    <span class="n">string_audio_data</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">NUM_SAMPLES</span><span class="p">)</span>
    <span class="c"># 将读入的数据转换为数组</span>
    <span class="n">audio_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">string_audio_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">short</span><span class="p">)</span>
    <span class="c"># 计算大于LEVEL的取样的个数</span>
    <span class="n">large_sample_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">audio_data</span> <span class="o">&gt;</span> <span class="n">LEVEL</span> <span class="p">)</span>
    <span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">audio_data</span><span class="p">)</span>
    <span class="c"># 如果个数大于COUNT_NUM，则至少保存SAVE_LENGTH个块</span>
    <span class="k">if</span> <span class="n">large_sample_count</span> <span class="o">&gt;</span> <span class="n">COUNT_NUM</span><span class="p">:</span>
        <span class="n">save_count</span> <span class="o">=</span> <span class="n">SAVE_LENGTH</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_count</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">save_count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">save_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">save_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># 将要保存的数据存放到save_buffer中</span>
        <span class="n">save_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">string_audio_data</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># 将save_buffer中的数据写入WAV文件，WAV文件的文件名是保存的时刻</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">save_buffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">_%H_%M_%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.wav&quot;</span>
            <span class="n">save_wave_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">save_buffer</span><span class="p">)</span>
            <span class="n">save_buffer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">print</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&quot;saved&quot;</span>
    <span class="n">content</span>
</pre></div>
</div>
</div>
</body>]]></description>
            <category><![CDATA[ Python ]]></category>
            <pubDate>Mon, 20 Aug 2012 16:00:00 GMT</pubDate>
        </item>
        <item>
            <link>http://jetgeng.github.com/blog/html/2012/07/15/nettywebconsole.html</link>
            <guid>http://jetgeng.github.com/blog/html/2012/07/15/nettywebconsole.html</guid>
            <title>让Netty接受WebSocket请求</title>
            <description><![CDATA[<?xml version="1.0" ?><body><div class="section" id="nettywebsocket">
<h1>让Netty接受WebSocket请求</h1>
<div class="section" id="id1">
<h2>缘起</h2>
<p>最近有个需要要求让 <a class="reference external" href="http://www.jboss.org/as7">JBoss AS 7</a> 支持WebSocket请求。遇到这样的问题，我的第一反应就是去想办法去换掉 <a class="reference external" href="http://www.jboss.org/as7">Jboss AS 7</a> 中的tomcat 容器或者把HTTP请求转发到另外一个容器中。一个老外 <a class="reference external" href="http://golovnin.blogspot.com/2012/04/jboss-7-and-websockets.html">JBoss 7 and WebSocket</a> 中就这么干的。但是觉得还存在一些问题。
所以一直在尝试其他方案，突然一天看到了Netty的架构图。发现他居然支持WebSocket接入。如果我做一个subsystem，把Netty装进去是不是就可以解决这个问题呢？</p>
</div>
<div class="section" id="id2">
<h2>尝试</h2>
<p>有这如上的想法以后，就得去验证。验证的第一步就是确定Netty是否真的能够支持WebSocket。什么话都不用说了上让代码证明一切吧！</p>
<p class="plantuml">
<img alt="interface AttributeMap{ } interface ChannelOutboundInvoker{     bind()     connect()     disconnect()     close()     deregister()     flush()     write(message:Object) } interface ChannelFutureFactory{ } interface Channel{     isOpen()     isRegistered()     isActive()  }  AttributeMap &lt;|-- Channel ChannelOutboundInvoker &lt;|-- Channel ChannelFutureFactory &lt;|-- Channel" src="http://jetgeng.github.com/blog/html/2012/07/15/../../../images/plantuml-f599b6a501d5f41f5c93b72954b0f663e170240b.png"/>
</p>
</div>
</div>
</body>]]></description>
            <category><![CDATA[ Jboss ]]></category>
            <pubDate>Sat, 14 Jul 2012 16:00:00 GMT</pubDate>
        </item>
        <item>
            <link>http://jetgeng.github.com/blog/html/2012/07/12/esper_source_read.html</link>
            <guid>http://jetgeng.github.com/blog/html/2012/07/12/esper_source_read.html</guid>
            <title>Esper 源码分析</title>
            <description><![CDATA[<?xml version="1.0" ?><body><div class="section" id="esper">
<h1>Esper 源码分析</h1>
</div>
</body>]]></description>
            <category><![CDATA[ Esper ]]></category>
            <pubDate>Wed, 11 Jul 2012 16:00:00 GMT</pubDate>
        </item>
        <item>
            <link>http://jetgeng.github.com/blog/html/2012/07/03/jbossover.html</link>
            <guid>http://jetgeng.github.com/blog/html/2012/07/03/jbossover.html</guid>
            <title>JBoss AS 7 学习笔记</title>
            <description><![CDATA[<?xml version="1.0" ?><body><div class="section" id="jboss-as-7">
<h1>JBoss AS 7 学习笔记</h1>
<div class="section" id="xnio">
<h2>XNIO模块</h2>
<p>我们先从jboss-as-remoting-test的着手了解他。
在RemotingSubsystemTestCase中</p>
<p class="plantuml">
<img alt="class AbstractSubsystemBaseTest{ }  class RemotingSubsystemTestCase{ }" src="http://jetgeng.github.com/blog/html/2012/07/03/../../../images/plantuml-43e98afc0df7eca3a76f0e56ea586e6b882d8153.png"/>
</p>
</div>
<div class="section" id="netty">
<h2>Netty模块</h2>
<p>这个东西是和MINA项目对等的。但是他的野心会大一点。直接支持web socket。有点意思。</p>
</div>
</div>
</body>]]></description>
            <category><![CDATA[ JBoss ]]></category>
            <pubDate>Mon, 02 Jul 2012 16:00:00 GMT</pubDate>
        </item>
    </channel>
</rss>